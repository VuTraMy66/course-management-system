<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Edit Course</title>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-5-stepper/dist/bootstrap-5-stepper.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-5-stepper/dist/css/bootstrap-5-stepper.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin.css}"/>

    <style>
        .list-group-item {
            background-color: white;
        }
    </style>

</head>
<body>
    <section class="containe">
        <div class="col-20">
            <div th:replace="~{fragments/admin-sidebar.html :: admin-sidebar}"></div>
        </div>
        <div class="col-80">
            <div th:replace="~{fragments/nav-admin.html :: admin-nav}"></div>
            <section class="py-4 py-lg-6 bg-primary">
                <div class="container">
                    <div class="row">
                        <div class="offset-lg-1 col-lg-10 col-md-12 col-12">
                            <div class="d-lg-flex align-items-center justify-content-between" th:object="${course}">
                                <div class="mb-4 mb-lg-0">
                                    <h1 class="text-white mb-1">Edit Course</h1>
                                    <p class="mb-0 text-white lead">Edit your <span th:text="${course.name}"></span> course.</p>
                                </div>
                                <div>
                                    <a th:href="@{/admin/course(course_id=${course.courseId})}" class="btn btn-white">Back to Course</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="pb-8">
                <div class="container">
                    <div id="courseForm" class="bs-stepper">
                        <div class="row">
                            <div class="offset-lg-1 col-lg-10 col-md-12 col-12">
                                <div class="bs-stepper-header shadow-sm" role="tablist">
                                    <div class="step active" data-target="#test-l-1">
                                        <button type="button" class="step-trigger" role="tab" id="courseFormtrigger1" aria-controls="test-l-1" aria-selected="true">
                                            <span class="bs-stepper-circle">1</span>
                                            <span class="bs-stepper-label">Basic Information</span>
                                        </button>
                                    </div>
                                    <div class="bs-stepper-line"></div>
                                    <div class="step" data-target="#test-l-2">
                                        <button type="button" class="step-trigger" role="tab" id="courseFormtrigger2" aria-controls="test-l-2" aria-selected="false">
                                            <span class="bs-stepper-circle">2</span>
                                            <span class="bs-stepper-label">Courses Media</span>
                                        </button>
                                    </div>
                                    <div class="bs-stepper-line"></div>
                                    <div class="step" data-target="#test-l-3">
                                        <button type="button" class="step-trigger" role="tab" id="courseFormtrigger3" aria-controls="test-l-3" aria-selected="false">
                                            <span class="bs-stepper-circle">3</span>
                                            <span class="bs-stepper-label">Curriculum</span>
                                        </button>
                                    </div>
                                    <div class="bs-stepper-line"></div>
                                    <div class="step" data-target="#test-l-4">
                                        <button type="button" class="step-trigger" role="tab" id="courseFormtrigger4" aria-controls="test-l-4" aria-selected="false">
                                            <span class="bs-stepper-circle">4</span>
                                            <span class="bs-stepper-label">Settings</span>
                                        </button>
                                    </div>
                                </div>
                                <!-- Stepper content -->
                                <div class="bs-stepper-content mt-5">
                                    <form th:object="${course}" th:action="@{/admin/update-course}" method="post">
                                        <div id="test-l-1" role="tabpanel" class="bs-stepper-pane fade active" aria-labelledby="courseFormtrigger1">
                                            <div class="card mb-3">
                                                <div class="card-header border-bottom px-4 py-3">
                                                    <h4 class="mb-0">Basic Information</h4>
                                                </div>
                                                <div class="card-body">
                                                    <input type="hidden" th:field="*{courseId}" />
                                                    <div class="mb-3">
                                                        <label for="addCourseTitle" class="form-label">Course title</label>
                                                        <input id="addCourseTitle" class="form-control" type="text" placeholder="Course title " th:field="*{name}"/>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label" for="addCourseCategory">Courses category</label>
                                                        <select class="form-select" id="addCourseCategory">
                                                            <option value="" th:selected="${course.category == ''}">Select category</option>
                                                            <option value="Data Science" th:selected="${course.category == 'Data Science'}">Data Science</option>
                                                            <option value="Programming" th:selected="${course.category == 'Programming'}">Programming</option>
                                                            <option value="Web Development" th:selected="${course.category == 'Web Development'}">Web Development</option>
                                                            <option value="Artificial Intelligence" th:selected="${course.category == 'Artificial Intelligence'}">Artificial Intelligence</option>
                                                            <option value="UI / UX Design" th:selected="${course.category == 'UI / UX Design'}">UI / UX Design</option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label" for="addCourseLevel">Courses level</label>
                                                        <select class="form-select" id="addCourseLevel" th:field="*{skillLevel}">
                                                            <option value="" th:selected="${course.skillLevel == ''}">Select level</option>
                                                            <option value="beginner" th:selected="${course.skillLevel == 'beginner'}">Beignner</option>
                                                            <option value="intermediate" th:selected="${course.skillLevel == 'intermediate'}">Intermediate</option>
                                                            <option value="advanced" th:selected="${course.skillLevel == 'advanced'}">Advance</option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Course description</label>
                                                        <textarea class="form-control" rows="5" placeholder="Insert course description here..." th:field="*{description}"></textarea>
                                                        <small>A brief summary of your courses.</small>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="addCourseDuration" class="form-label">Course duration</label>
                                                        <input id="addCourseDuration" class="form-control" type="text" placeholder="Course duration " th:field="*{duration}"/>
                                                        <small>Duration in minutes.</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-end">
                                                <button class="btn btn-primary" type="button" onclick="courseForm.next()">Next</button>
                                            </div>
                                        </div>
                                        <div id="test-l-2" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="courseFormtrigger2">
                                            <div class="card mb-3 border-0">
                                                <div class="card-header border-bottom px-4 py-3">
                                                    <h4 class="mb-0">Courses Media</h4>
                                                </div>
                                                <div class="card-body">
                                                    <div class="custom-file-container mb-4" data-upload-id="courseImage">
                                                        <div class="label-container d-flex justify-content-between align-items-center">
                                                            <label>Upload Course Image</label>
                                                            <a class="clear-button" id="clearImage" title="Clear Image">
                                                                <i class="bi bi-x" style="height: 15px; width: 15px;"></i>
                                                            </a>
                                                        </div>
                                                        <label class="input-container">
                                                            <input accept="*" aria-label="Choose File" type="file" id="file-upload-with-preview-courseImage" class="input-hidden" data-has-listeners="true"/>
                                                            <span class="input-visible">
                                                                Choose file...
                                                                <span class="browse-button">Browse</span>
                                                            </span>
                                                        </label>
                                                        <small class="d-block mt-2">Upload an image that represents your course.</small>
                                                    </div>
                                                    <div class="mt-3 mb-4" id="imagePreview" th:style="${course.image != null} ? '' : 'display: none;'">
                                                        <img id="preview" class="img-fluid rounded" th:src="@{${course.image}}" alt="Course Image Preview" />
                                                    </div>
                                                </div>                                                
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <button class="btn btn-secondary" type="button" onclick="courseForm.previous()">Previous</button>
                                                <button class="btn btn-primary" type="button" onclick="courseForm.next()">Next</button>
                                            </div>
                                        </div>

                                        <script>
                                            document.getElementById('file-upload-with-preview-courseImage').addEventListener('change', function(e) {
                                                const file = e.target.files[0];
                                                if (file) {
                                                    const reader = new FileReader();
                                                    reader.onload = function(event) {
                                                        document.getElementById('imagePreview').style.display = 'block';
                                                        document.getElementById('preview').setAttribute('src', event.target.result);
                                                    }
                                                    reader.readAsDataURL(file); 
                                                }
                                            });

                                            document.getElementById('clearImage').addEventListener('click', function() {
                                                document.getElementById('file-upload-with-preview-courseImage').value = ''; 
                                                document.getElementById('imagePreview').style.display = 'none'; 
                                                document.getElementById('preview').setAttribute('src', '');
                                            });
                                        </script>

                                        <div id="test-l-3" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="courseFormtrigger3">
                                            <div class="card mb-3 border-0">
                                                <div class="card-header border-bottom px-4 py-3">
                                                    <h4 class="mb-0">Curriculum</h4>
                                                </div>
                                                <div class="card-body">
                                                    <div class="bg-light rounded p-2 mb-4">
                                                        <div class="list-group list-group-flush border-top-0" id="courseList">
                                                            <div class="list-group-item rounded px-3 text-nowrap mb-2" id="introduction">
                                                                <div class="mt-3 mb-3">
                                                                    <label for="addSessionTitle" class="form-label">Session title</label>
                                                                    <input id="addSessionTitle" name="addSessionTitle" class="form-control" type="text" placeholder="Session title " />
                                                                    <small class="mt-1">Write a 60 character session title.</small>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label class="form-label">Short description</label>
                                                                    <textarea class="form-control" rows="5" placeholder="Insert session description here..."></textarea>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="addSessionUrl" class="form-label">Video URL</label>
                                                                    <input id="addSessionUrl" name="addSessionUrl" class="form-control" type="text" placeholder="Url... " />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <a id="addSessionBtn" class="btn btn-outline-primary btn-sm mt-3">Add Session +</a>

                                                        <script>
                                                            document.getElementById('addSessionBtn').addEventListener('click', function () {
                                                                // Create new list-group-item element
                                                                const newSession = document.createElement('div');
                                                                newSession.className = 'list-group-item rounded px-3 text-nowrap mb-2';

                                                                // Define the inner HTML for the new session
                                                                newSession.innerHTML = `
                                                                    <div class="mt-3 mb-3">
                                                                        <label for="addSessionTitle" class="form-label">Session title</label>
                                                                        <input name="addSessionTitle" class="form-control" type="text" placeholder="Session title" />
                                                                        <small class="mt-1">Write a 60 character session title.</small>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Short Description</label>
                                                                        <textarea class="form-control" rows="5" placeholder="Insert session description here..."></textarea>
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <label for="addSessionUrl" class="form-label">Video URL</label>
                                                                        <input name="addSessionUrl" class="form-control" type="text" placeholder="Url..." />
                                                                    </div>
                                                                `;

                                                                // Append the new session to the course list
                                                                document.getElementById('courseList').appendChild(newSession);
                                                            });

                                                        </script>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <button class="btn btn-secondary" type="button" onclick="courseForm.previous()">Previous</button>
                                                <button class="btn btn-primary" type="button" onclick="courseForm.next()">Next</button>
                                            </div>
                                        </div>
                                        <div id="test-l-4" role="tabpanel" class="bs-stepper-pane fade" aria-labelledby="courseFormtrigger4">
                                            <div class="card mb-3 border-0">
                                                <div class="card-header border-bottom px-4 py-3">
                                                    <h4 class="mb-0">Requirements</h4>
                                                </div>
                                                <div class="card-body">
                                                    <input name="tags" class="w-100" value="jquery, bootstrap" />
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-between mb-8">
                                                <button class="btn btn-secondary" type="button" onclick="courseForm.previous()">Previous</button>
                                                <div>
                                                    <!-- <button type="submit" class="btn btn-secondary">Save draft</button> -->
                                                    <button type="submit" class="btn btn-danger">Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <script>
        // Handle click events for step navigation
        document.querySelectorAll('.step-trigger').forEach((step) => {
            step.addEventListener('click', function() {
                // Deactivate all steps and hide all panels
                document.querySelectorAll('.step').forEach(s => {
                    s.classList.remove('active');
                });
                document.querySelectorAll('.bs-stepper-pane').forEach(pane => {
                    pane.classList.remove('active', 'dstepper-block');
                });
    
                // Activate the clicked step
                step.parentElement.classList.add('active');
                
                // Show the associated panel
                const targetId = step.getAttribute('aria-controls');
                document.getElementById(targetId).classList.add('active', 'dstepper-block');
    
                // Update the currentTab to match the clicked step index
                courseForm.currentTab = Array.from(document.querySelectorAll('.step')).indexOf(step.parentElement) + 1;
            });
        });
    
        // Object to handle next and previous actions
        const courseForm = {
            currentTab: 1,
    
            // Function to display the correct tab based on index
            showTab(index) {
                const tabs = document.querySelectorAll('.bs-stepper-pane');
                tabs.forEach((tab, i) => {
                    tab.classList.remove('active', 'dstepper-block');
                    if (i + 1 === index) {
                        tab.classList.add('active', 'dstepper-block');
                    }
                });
    
                // Update the active step trigger
                const steps = document.querySelectorAll('.step');
                steps.forEach((step, i) => {
                    step.classList.remove('active');
                    if (i + 1 === index) {
                        step.classList.add('active');
                    }
                });
            },
    
            // Move to the next tab
            next() {
                if (this.currentTab < 4) {
                    this.currentTab++;
                    this.showTab(this.currentTab);
                }
                
                // Kiểm tra nếu đã đến bước cuối cùng (bước 4)
                if (this.currentTab === 4) {
                    // Lấy form và gọi submit
                    document.querySelector('form').submit();
                }
            },
                
            // Move to the previous tab
            previous() {
                if (this.currentTab > 1) {
                    this.currentTab--;
                    this.showTab(this.currentTab);
                }
            }
        };
    </script>    

    <!-- Scroll  -->
    <div th:replace="fragments/scroll-to-top.html :: scroll"></div> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        feather.replace();
    </script>
</body>
</html>